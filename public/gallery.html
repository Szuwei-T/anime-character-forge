<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‰ΩúÂìÅÂ±ïÁ§∫</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .page-wrap{max-width:1180px;margin:0 auto;padding:22px 18px 44px;}
    .topbar{display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:16px;}
    .title{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
    .title h1{font-size:22px;margin:0;letter-spacing:1px;}
    .badge{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font-size:12px;opacity:.95}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{cursor:pointer;user-select:none;padding:10px 14px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);font-size:13px;transition:.15s}
    .btn:hover{background:rgba(255,255,255,.10)}
    .statusline{margin:10px 0 12px;opacity:.9}
    .errorbox{margin:10px 0 12px;padding:10px 12px;border-radius:12px;background:rgba(255,0,0,.10);border:1px solid rgba(255,0,0,.25);color:#ffb3b3}

    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 14px;align-items:center}
    .chip{
      cursor:pointer;
      user-select:none;
      padding:10px 14px;
      border-radius:999px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      font-size:13px;
      opacity:.9
    }
    .chip.active{background:rgba(255,255,255,.14);opacity:1}
    .select{
      padding:10px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      color:inherit;
      outline:none;
    }

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:14px}
    .card{border-radius:18px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.10);overflow:hidden;cursor:pointer;transition:.15s;position:relative}
    .card:hover{background:rgba(255,255,255,.07)}
    .thumb{aspect-ratio:3/4;background:rgba(0,0,0,.15);position:relative}
    .thumb .layer{position:absolute;inset:0}
    .thumb .layer img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;display:block}

    .meta{padding:10px 12px}
    .meta .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .meta .t{font-size:12px;opacity:.85;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .meta .s{font-size:12px;opacity:.70;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .pill{
      padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.14);font-size:12px;white-space:nowrap
    }

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.60);display:none;align-items:center;justify-content:center;padding:18px;z-index:9999}
    .modal.show{display:flex}
    .modalbox{width:min(920px,100%);max-height:92vh;border-radius:18px;background:rgba(20,22,30,.96);border:1px solid rgba(255,255,255,.12);overflow:hidden;display:flex;flex-direction:column}
    .modalhead{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.10)}
    .modalhead .h{font-size:14px;opacity:.9}
    .modalhead .x{cursor:pointer;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.10);font-size:12px}
    .modalbody{padding:14px;overflow:auto;max-height:calc(92vh - 54px)}
    .bigwrap{width:100%;aspect-ratio:1365/2048;background:rgba(0,0,0,.20);border-radius:14px;overflow:hidden;position:relative}
    .bigwrap .layer{position:absolute;inset:0}
    .bigwrap .layer img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;display:block}
    .footnote{margin-top:10px;font-size:12px;opacity:.75}
    .empty{opacity:.75;padding:14px 0}
  
    .voteBar{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:10px}
    .voteBtn{cursor:pointer;user-select:none;padding:9px 12px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.14);font-size:13px;transition:.15s;font-weight:800}
    .voteBtn:hover{background:rgba(255,255,255,.10)}
    .voteBtn:disabled{opacity:.45;cursor:not-allowed}
    .voteCount{font-size:12px;opacity:.86;font-weight:800}


/* Podium */
.podiumWrap{
  margin:14px 0 10px;
  padding:14px 14px 12px;
  border-radius:18px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.10);
  overflow:hidden;
}
.podiumTitle{
  display:flex;align-items:center;justify-content:space-between;
  gap:10px;margin-bottom:10px
}
.podiumTitle .h{font-size:14px;font-weight:900;letter-spacing:.3px;opacity:.95}
.podiumTitle .sub{font-size:12px;opacity:.75}
.podium{
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap:12px;
  align-items:end;
}
.podItem{
  cursor:pointer;
  user-select:none;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  overflow:hidden;
  transition:.15s;
  display:flex;
  flex-direction:column;
}
.podItem:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.06)}
.podTop{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 12px;
  border-bottom:1px solid rgba(255,255,255,.08);
  gap:10px;
}
.podRank{
  font-weight:1000;
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
  white-space:nowrap;
}
.podVotes{font-size:12px;opacity:.9;font-weight:900;white-space:nowrap}
.podThumb{
  width:100%;
  aspect-ratio: 1365/2048;
  position:relative;
  background:rgba(0,0,0,.20);
}
.podThumb .layer{position:absolute;inset:0}
.podThumb .layer img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;display:block}
.podMeta{padding:10px 12px 12px}
.podMeta .t{font-size:12px;font-weight:900;opacity:.95;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.podMeta .s{font-size:12px;opacity:.75;margin-top:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.podItem.rank1{min-height:310px}
.podItem.rank2{min-height:280px;opacity:.92}
.podItem.rank3{min-height:270px;opacity:.90}

  
.author{
  display:flex;
  gap:8px;
  align-items:center;
  font-size:13px;
  opacity:.92;
  padding:0 12px 10px 12px;
  cursor:pointer;
}
.author .lv{
  padding:2px 8px;
  border:1px solid rgba(255,255,255,.18);
  border-radius:999px;
  background:rgba(0,0,0,.18);
  font-weight:700;
}
.actions{
  display:flex;
  gap:8px;
  padding:0 12px 12px 12px;
}
.btn.mini{
  padding:8px 10px;
  font-size:13px;
  border-radius:10px;
}
.btn.mini.on{
  opacity:.95;
  border-color: rgba(255,255,255,.35);
}


/* Podium rank styling override */
.podium{align-items:end;}
.podItem{border-radius:18px;}
.podItem.rank1{
  border:3px solid #FFD700;
  box-shadow: 0 0 14px rgba(255,215,0,.65), 0 0 34px rgba(255,215,0,.35);
  background:rgba(0,0,0,.22);
  position:relative;
}
.podItem.rank1::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:20px;
  background: radial-gradient(circle at 30% 10%, rgba(255,215,0,.35), transparent 45%),
              radial-gradient(circle at 70% 70%, rgba(255,215,0,.22), transparent 55%);
  pointer-events:none;
  mix-blend-mode:screen;
  animation:podGoldPulse 2.2s ease-in-out infinite;
}
@keyframes podGoldPulse{
  0%{opacity:.45; filter:blur(0px);}
  100%{opacity:.85; filter:blur(1px);}
}
.podItem.rank1 .podRank{background:rgba(255,215,0,.18);border-color:rgba(255,215,0,.55)}
.podItem.rank1 .podThumb{box-shadow: inset 0 0 0 1px rgba(255,215,0,.45);}

.podItem.rank2{
  border:3px solid #C0C0C0;
  box-shadow: 0 0 10px rgba(192,192,192,.35);
  background:rgba(0,0,0,.20);
}
.podItem.rank2 .podRank{background:rgba(192,192,192,.14);border-color:rgba(192,192,192,.45)}
.podItem.rank2 .podThumb{
  transform:scale(.8);
  transform-origin:bottom center;
}

.podItem.rank3{
  border:3px solid #CD7F32;
  box-shadow:none;
  background:rgba(0,0,0,.18);
}
.podItem.rank3 .podRank{background:rgba(205,127,50,.14);border-color:rgba(205,127,50,.45)}
.podItem.rank3 .podThumb{
  transform:scale(.6);
  transform-origin:bottom center;
}

/* SCALE ENTIRE PODIUM CARD INCLUDING BORDER */
.podium-card {
  transform-origin: bottom center;
}

.podium-card.rank1 {
  transform: scale(1);
}

.podium-card.rank2 {
  transform: scale(0.8);
}

.podium-card.rank3 {
  transform: scale(0.6);
}


/* ===== Podium inner border fix v5 ===== */

/* remove outer border for rank2 and rank3 */
.podium-card.rank2,
.podium-card.rank3 {
  border: none !important;
  box-shadow: none !important;
}

/* ensure thumb supports inner border */
.podium-card .thumb {
  position: relative;
}

/* inner border layer */
.podium-card.rank2 .thumb::before,
.podium-card.rank3 .thumb::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 14px;
  pointer-events: none;
}

/* silver border rank2 */
.podium-card.rank2 .thumb::before {
  border: 3px solid #C0C0C0;
  box-shadow: 0 0 12px rgba(192,192,192,0.7);
}

/* bronze border rank3 */
.podium-card.rank3 .thumb::before {
  border: 3px solid #CD7F32;
}

/* new scales */
.podium-card.rank2 {
  transform: scale(0.9);
}

.podium-card.rank3 {
  transform: scale(0.8);
}


/* ===== Podium effects v6 ===== */

/* Rank1 floating gold particles */
.podium-card.rank1 .thumb::after,
.podium-card.rank1 .thumb::before{
  content:"";
  position:absolute;
  inset:-10%;
  pointer-events:none;
  border-radius:18px;
}

/* particle layer */
.podium-card.rank1 .thumb::after{
  background-image:
    radial-gradient(circle at 12% 18%, rgba(255,215,0,.85) 0 2px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 28% 72%, rgba(255,215,0,.65) 0 1.6px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 62% 34%, rgba(255,215,0,.75) 0 2.2px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 78% 64%, rgba(255,215,0,.55) 0 1.4px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 44% 88%, rgba(255,215,0,.7) 0 2px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 88% 22%, rgba(255,215,0,.6) 0 1.6px, rgba(255,215,0,0) 3px);
  filter: blur(.2px);
  opacity:.9;
  animation: goldFloat 5.5s linear infinite;
  mix-blend-mode: screen;
}

/* soft glow sweep layer */
.podium-card.rank1 .thumb::before{
  background: linear-gradient(120deg,
    rgba(255,215,0,0) 0%,
    rgba(255,215,0,.18) 30%,
    rgba(255,215,0,0) 60%);
  transform: translateX(-40%) translateY(10%) rotate(8deg);
  animation: goldSweep 3.2s ease-in-out infinite;
  mix-blend-mode: screen;
}

@keyframes goldFloat{
  0%   { transform: translateY(18px) translateX(-10px); opacity:.75; }
  50%  { transform: translateY(-10px) translateX(10px); opacity:1; }
  100% { transform: translateY(18px) translateX(-10px); opacity:.75; }
}
@keyframes goldSweep{
  0%   { transform: translateX(-55%) translateY(12%) rotate(8deg); opacity:.55; }
  50%  { transform: translateX(55%) translateY(-6%) rotate(8deg); opacity:.9; }
  100% { transform: translateX(-55%) translateY(12%) rotate(8deg); opacity:.55; }
}

/* Rank2 silver shimmer flow */
.podium-card.rank2 .thumb::after{
  content:"";
  position:absolute;
  inset:-10%;
  pointer-events:none;
  border-radius:14px;
  background: linear-gradient(115deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,.10) 25%,
    rgba(255,255,255,.28) 45%,
    rgba(255,255,255,.10) 65%,
    rgba(255,255,255,0) 100%);
  transform: translateX(-70%);
  animation: silverShimmer 2.4s linear infinite;
  mix-blend-mode: screen;
  opacity:.85;
}

@keyframes silverShimmer{
  0%   { transform: translateX(-75%); }
  100% { transform: translateX(75%); }
}

/* Rank3 metallic texture without glow */
.podium-card.rank3 .thumb{
  background-image:
    linear-gradient(135deg, rgba(255,255,255,.05) 0%, rgba(255,255,255,0) 40%, rgba(0,0,0,.10) 100%),
    repeating-linear-gradient(90deg, rgba(255,255,255,.04) 0 2px, rgba(255,255,255,0) 2px 7px);
  background-blend-mode: overlay;
}


/* ===== Podium effects v7 (apply to existing podItem / podThumb classes) ===== */

/* ensure podThumb can host pseudo layers */
.podThumb{
  position: relative;
  overflow: hidden;
  border-radius: 14px;
}

/* hide outer frame for rank2 and rank3 */
.podItem.rank2,
.podItem.rank3{
  border-color: transparent !important;
  box-shadow: none !important;
}

/* inner frame between image and outer frame */
.podItem.rank2 .podThumb::before,
.podItem.rank3 .podThumb::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:14px;
  pointer-events:none;
}

/* rank2 silver inner frame + normal glow */
.podItem.rank2 .podThumb::before{
  border:3px solid rgba(192,192,192,1);
  box-shadow: 0 0 12px rgba(192,192,192,.65);
}

/* rank3 bronze inner frame, no glow */
.podItem.rank3 .podThumb::before{
  border:3px solid rgba(205,127,50,1);
}

/* new preview size */
.podItem.rank2 .podThumb{
  transform: scale(0.9);
  transform-origin: bottom center;
}
.podItem.rank3 .podThumb{
  transform: scale(0.8);
  transform-origin: bottom center;
}

/* Rank1 gold particles + sweep */
.podItem.rank1 .podThumb::after,
.podItem.rank1 .podThumb::marker{}

/* particles */
.podItem.rank1 .podThumb::after{
  content:"";
  position:absolute;
  inset:-10%;
  pointer-events:none;
  background-image:
    radial-gradient(circle at 12% 18%, rgba(255,215,0,.85) 0 2px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 28% 72%, rgba(255,215,0,.65) 0 1.6px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 62% 34%, rgba(255,215,0,.75) 0 2.2px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 78% 64%, rgba(255,215,0,.55) 0 1.4px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 44% 88%, rgba(255,215,0,.7) 0 2px, rgba(255,215,0,0) 3px),
    radial-gradient(circle at 88% 22%, rgba(255,215,0,.6) 0 1.6px, rgba(255,215,0,0) 3px);
  opacity:.9;
  animation: goldFloat 5.5s linear infinite;
  mix-blend-mode: screen;
}

/* sweep */
.podItem.rank1 .podThumb::before{
  content:"";
  position:absolute;
  inset:-10%;
  pointer-events:none;
  background: linear-gradient(120deg,
    rgba(255,215,0,0) 0%,
    rgba(255,215,0,.18) 30%,
    rgba(255,215,0,0) 60%);
  transform: translateX(-55%) translateY(12%) rotate(8deg);
  animation: goldSweep 3.2s ease-in-out infinite;
  mix-blend-mode: screen;
}

@keyframes goldFloat{
  0%   { transform: translateY(18px) translateX(-10px); opacity:.75; }
  50%  { transform: translateY(-10px) translateX(10px); opacity:1; }
  100% { transform: translateY(18px) translateX(-10px); opacity:.75; }
}
@keyframes goldSweep{
  0%   { transform: translateX(-55%) translateY(12%) rotate(8deg); opacity:.55; }
  50%  { transform: translateX(55%) translateY(-6%) rotate(8deg); opacity:.9; }
  100% { transform: translateX(-55%) translateY(12%) rotate(8deg); opacity:.55; }
}

/* Rank2 silver shimmer flow (add on top of inner frame) */
.podItem.rank2 .podThumb::after{
  content:"";
  position:absolute;
  inset:-12%;
  pointer-events:none;
  background: linear-gradient(115deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,.10) 25%,
    rgba(255,255,255,.28) 45%,
    rgba(255,255,255,.10) 65%,
    rgba(255,255,255,0) 100%);
  transform: translateX(-75%);
  animation: silverShimmer 2.4s linear infinite;
  mix-blend-mode: screen;
  opacity:.85;
}

@keyframes silverShimmer{
  0%   { transform: translateX(-75%); }
  100% { transform: translateX(75%); }
}

/* Rank3 metallic texture no animation */
.podItem.rank3 .podThumb::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background-image:
    linear-gradient(135deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,0) 40%, rgba(0,0,0,.12) 100%),
    repeating-linear-gradient(90deg, rgba(255,255,255,.05) 0 2px, rgba(255,255,255,0) 2px 7px);
  mix-blend-mode: overlay;
  opacity:.9;
}



.author{display:flex;align-items:center;gap:8px}
.author .av{width:28px;height:28px;border-radius:50%;overflow:hidden;display:inline-flex;align-items:center;justify-content:center;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);flex:0 0 auto}
.author .meta{display:flex;gap:6px;align-items:center}
.author .avImg{width:28px;height:28px;object-fit:cover;display:block}
.author .avStack{position:relative;width:28px;height:28px;display:block}
.author .avStack img{position:absolute;inset:0;width:28px;height:28px;object-fit:contain;display:block}
.author .avTxt{font-weight:900;font-size:12px;opacity:.9}


    /* Premium gallery layout */
    .sectionTitle{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;margin:10px 0 10px}
    .sectionTitle .h{font-size:14px;letter-spacing:.5px;opacity:.92}
    .sectionTitle .sub{font-size:12px;opacity:.68}

    .recWrap{margin:14px 0 10px}
    .recTitle{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;margin:6px 0 10px}
    .recTitle .h{font-size:14px;letter-spacing:.5px;opacity:.92}
    .recTitle .sub{font-size:12px;opacity:.68}

    .recGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:14px}
    .recCard{border-radius:18px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);overflow:hidden;cursor:pointer;transition:.15s;position:relative}
    .recCard:hover{background:rgba(255,255,255,.08)}
    .recThumb{aspect-ratio:3/4;background:rgba(0,0,0,.16);position:relative}
    .recMeta{padding:10px 12px;display:flex;flex-direction:column;gap:8px}
    .recTopRow{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .recTitleLine{font-size:12px;opacity:.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .recBadge{padding:6px 10px;border-radius:999px;background:rgba(255,165,0,.10);border:1px solid rgba(255,165,0,.22);font-size:12px;white-space:nowrap}

    .entries{display:flex;flex-direction:column;gap:10px}
    .entry{display:flex;gap:12px;align-items:stretch;border-radius:18px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.10);overflow:hidden;cursor:pointer;transition:.15s}
    .entry:hover{background:rgba(255,255,255,.07)}
    .entryThumb{width:112px;flex:0 0 112px;aspect-ratio:3/4;background:rgba(0,0,0,.16);position:relative}
    .entryThumb .layer{position:absolute;inset:0}
    .entryThumb .layer img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;display:block}
    .entryBody{flex:1;min-width:0;padding:10px 12px;display:flex;flex-direction:column;gap:8px}
    .entryHeader{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .entryTitle{font-size:13px;opacity:.92;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .kv{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .kv .pill2{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);font-size:12px;opacity:.9}
    .authorRow{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .authorMini{display:flex;align-items:center;gap:10px;min-width:0}
    .authorMini .av{width:30px;height:30px;border-radius:999px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);display:grid;place-items:center;overflow:hidden}
    .authorMini .nm{font-size:12px;opacity:.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:240px}
    .authorMini .lv{font-size:12px;opacity:.65}
    .iconRow{display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .iconBtn{display:flex;align-items:center;gap:6px;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);cursor:pointer;color:inherit;font-size:12px;transition:.15s}
    .iconBtn:hover{background:rgba(255,255,255,.10)}
    .iconBtn.on{background:rgba(120,255,200,.08);border-color:rgba(120,255,200,.20)}
    .iconBtn.warn{background:rgba(255,165,0,.10);border-color:rgba(255,165,0,.22)}
    .iconBtn.danger{background:rgba(255,90,90,.10);border-color:rgba(255,90,90,.22)}
    .icon{width:16px;height:16px;display:block;opacity:.9}
    .metaLine{font-size:12px;opacity:.65;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:rgba(15,18,26,.92);border:1px solid rgba(255,255,255,.14);padding:10px 12px;border-radius:999px;font-size:12px;opacity:0;pointer-events:none;transition:.2s;z-index:99999}
    .toast.show{opacity:1}

</style>
</head>

<body>
  <div class="page-wrap">
    <div class="topbar">
      <div class="title">
        <h1>‰ΩúÂìÅÂ±ïÁ§∫</h1>
        <div class="badge">Â∏≥Ëôü <span id="uidBadge">Êú™ÁôªÂÖ•</span></div>
        <div class="badge">ÁãÄÊÖã <span id="netBadge">Ê™¢Êü•‰∏≠</span></div>
        <div class="badge">Á•®Âà∏ <span id="voteBadge">0</span></div>
      </div>
      <div class="actions">
        <div class="btn" id="btnStudio">ÂõûÂ∑•‰ΩúÂÆ§</div>
        <div class="btn" id="btnRecipes">ÊàêÂìÅÂ∫´</div>
        <div class="btn" id="btnHome">È¶ñÈ†Å</div>
      </div>
    </div>


<div class="podiumWrap" id="podiumWrap" style="display:none;">
  <div class="podiumTitle">
    <div class="h">üèÜ Êú¨ÊúüÈ†íÁçéÂè∞</div>
    <div class="sub" id="podiumSub">Á•®Êï∏ÊúÄÈ´òÁöÑ 3 ÂÄã‰ΩúÂìÅ</div>
  </div>
  <div class="podium" id="podium"></div>
</div>


<div class="recWrap" id="recWrap" style="display:none;">
  <div class="recTitle">
    <div class="h">üî• Êú¨ÊúüÊé®Ëñ¶</div>
    <div class="sub" id="recSub">Êé®Ëñ¶Ê¨°Êï∏ > 1 ÁöÑ‰ΩúÂìÅ</div>
  </div>
  <div class="recGrid" id="recGrid"></div>
</div>


    <div class="toolbar">
      <div class="chip active" id="chipNewest">ÊúÄÊñ∞</div>
      <div class="chip" id="chipTop">ÊúÄÈ´òÂàÜ</div>
      <select class="select" id="seasonSel" title="Season">
        <option value="">ÂÖ®ÈÉ® Season</option>
        <option value="S1">S1</option>
      </select>
      <div class="btn" id="btnReload">ÈáçÊñ∞Êï¥ÁêÜ</div>
    </div>

    <div class="statusline" id="statusLine">ËÆÄÂèñ‰∏≠</div>
    <div id="errorBox" class="errorbox" style="display:none;"></div>

    <div class="entries" id="grid"></div>
    <div class="toast" id="toast"></div>
  </div>

  <div class="modal" id="modal">
    <div class="modalbox">
      <div class="modalhead">
        <div class="h" id="modalTitle">È†êË¶Ω</div>
        <div class="x" id="modalClose">ÈóúÈñâ</div>
      </div>
      <div class="modalbody">
        <div class="bigwrap" id="bigwrap"></div>
        <div class="footnote" id="modalMeta"></div>
      </div>
    </div>
  </div>

<script>
(function(){
  const DEFAULT_WORKER = "https://acf-api.dream-league-baseball.workers.dev";
  const WORKER_BASE = window.WORKER_BASE || localStorage.getItem("acf_worker_base") || DEFAULT_WORKER;

  const uid = localStorage.getItem("acf_uid") || "";
  const uidBadge = document.getElementById("uidBadge");
  const netBadge = document.getElementById("netBadge");
  const voteBadge = document.getElementById("voteBadge");
  const statusLine = document.getElementById("statusLine");
  const errorBox = document.getElementById("errorBox");
  const grid = document.getElementById("grid");
const recWrap = document.getElementById("recWrap");
const recGrid = document.getElementById("recGrid");
const recSub = document.getElementById("recSub");
const toast = document.getElementById("toast");

  const chipNewest = document.getElementById("chipNewest");
  const chipTop = document.getElementById("chipTop");
  const seasonSel = document.getElementById("seasonSel");

  const modal = document.getElementById("modal");
  const modalClose = document.getElementById("modalClose");
  const modalTitle = document.getElementById("modalTitle");
  const modalMeta = document.getElementById("modalMeta");
  const bigwrap = document.getElementById("bigwrap");

  uidBadge.textContent = uid ? uid : "Êú™ÁôªÂÖ•";

  let userVote = 0;

let followingSet = new Set();
let favoriteSet = new Set();

async function loadMeSocial(){
  if(!uid) return;
  try{
    const acc = await api("/api/me/account");
    if(acc && acc.account){
      setVoteBadge(acc.account.userVote || 0);
    }
    const fav = await api("/api/me/favorites");
    favoriteSet = new Set((fav.items || []).map(x=>String(x.showcaseId)));
    const fol = await api("/api/me/following");
    followingSet = new Set((fol.items || []).map(x=>String(x.targetUserId)));
  }catch(_){}
}

function openUser(uid2){
  const u = String(uid2||"").trim();
  if(!u) return;
  location.href = "/user.html?uid=" + encodeURIComponent(u);
}


  function setVoteBadge(n){
    const v = Number(n || 0);
    userVote = v;
    if(voteBadge) voteBadge.textContent = String(v);
  }


  document.getElementById("btnStudio").onclick = () => location.href = "/studio";
  document.getElementById("btnRecipes").onclick = () => location.href = "/recipes";
  document.getElementById("btnHome").onclick = () => location.href = "/";
  document.getElementById("btnReload").onclick = () => load();

  function setNet(ok){
    netBadge.textContent = ok ? "Online" : "Offline";
    netBadge.style.opacity = ok ? "1" : ".75";
  }
  function showError(msg){
    errorBox.style.display = "block";
    errorBox.textContent = msg;
  }
  function clearError(){
    errorBox.style.display = "none";
    errorBox.textContent = "";
  }

  

  function showToast(msg){
    if(!toast) return;
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove("show"), 1400);
  }
function api(path, opts={}){
    const method = (opts.method || "GET").toUpperCase();
    const headers = {
      "content-type": "application/json",
      "x-user-id": uid || ""
    };
    const fetchOpts = { method, headers };
    if(opts.body !== undefined) fetchOpts.body = JSON.stringify(opts.body);

    return fetch(WORKER_BASE + path, fetchOpts).then(async (r) => {
      const t = await r.text();
      let j = {};
      try { j = t ? JSON.parse(t) : {}; } catch { j = { ok:false, error:"bad_json", raw:t }; }
      if (!r.ok || j.ok === false) {
        const e = (j && (j.error || j.message)) ? (j.error || j.message) : ("HTTP " + r.status);
        throw new Error(e + (j && j.detail ? (" - " + j.detail) : ""));
      }
      return j;
    });
  }


  async function loadMyAccount(){
    if(!uid){
      setVoteBadge(0);
      return;
    }
    const endpoints = ["/api/me/account"];
    for(const ep of endpoints){
      try{
        const r = await api(ep);
        const uv =
          (r && (r.userVote ?? r.user_vote)) ??
          (r && r.user && (r.user.userVote ?? r.user.user_vote)) ??
          (r && r.account && (r.account.userVote ?? r.account.user_vote));
        if(uv !== undefined){
          setVoteBadge(Number(uv || 0));
          return;
        }
      }catch(_){}
    }
    setVoteBadge(userVote || 0);
  }

  function getVoteCount(s){
    const v =
      s.votes ?? s.voteCount ?? s.vote_count ??
      s.voteTotal ?? s.vote_total ??
      s.upvotes ?? s.upVotes ??
      s.ticketVotes ?? s.ticket_votes;
    return Number(v || 0);
  }

  async function voteFor(showcaseId, btnEl, countEl){
    clearError();
    if(!uid){
      showError("Â∞öÊú™ÁôªÂÖ•ÔºåÁÑ°Ê≥ïÊäïÁ•®");
      return;
    }
    if(Number(userVote || 0) <= 0){
      showError("‰Ω†Ê≤íÊúâÁ•®Âà∏ÔºåÁÑ°Ê≥ïÊäïÁ•®");
      return;
    }
    if(!showcaseId){
      showError("‰ΩúÂìÅ id ‰∏çÂ≠òÂú®ÔºåÁÑ°Ê≥ïÊäïÁ•®");
      return;
    }

    if(btnEl) btnEl.disabled = true;

    try{
      const r = await api("/api/vote", { method:"POST", body:{ showcaseId } });

      const remain =
        (r && (r.userVote ?? r.user_vote ?? r.remainingVote ?? r.remaining_vote)) ??
        (r && r.account && (r.account.userVote ?? r.account.user_vote));
      if(remain !== undefined) setVoteBadge(Number(remain || 0));
      else setVoteBadge(Math.max(0, Number(userVote || 0) - 1));

      const newCount =
        (r && (r.voteCount ?? r.vote_count ?? r.count ?? r.total)) ??
        (r && r.item && (r.item.voteCount ?? r.item.vote_count)) ??
        undefined;

      let finalCount = undefined;
      if(newCount !== undefined){
        finalCount = Number(newCount || 0);
        if(countEl) countEl.textContent = "Á•®Êï∏ " + String(finalCount);
      }else{
        // fallback optimistic update
        if(countEl){
          const cur = Number(String(countEl.textContent || "").replace(/[^0-9]/g, "") || 0);
          finalCount = cur + 1;
          countEl.textContent = "Á•®Êï∏ " + String(finalCount);
        }
      }

      // Refresh podium in-place
      try{
        if(Array.isArray(lastFilteredItems) && lastFilteredItems.length){
          const it = lastFilteredItems.find(x => String(x.showcaseId || x.id || x.showcase_id || x.showcaseID || "") === String(showcaseId));
          if(it && finalCount !== undefined){ it.voteCount = Number(finalCount || 0); it.votes = Number(finalCount || 0); }
          renderPodiumFromItems(lastFilteredItems);
        }
      }catch(e){}

    }catch(e){
      const msg = String(e && e.message ? e.message : e);
      
if(msg.includes("max_per_showcase_reached")){
  const used = Number(e && (e.used ?? e.count ?? 5) ? (e.used ?? e.count ?? 5) : 5);
  showError("‰Ω†Âú®Êú¨Ë≥ΩÂ≠£Â∞çÈÄôÂÄã‰ΩúÂìÅÂ∑≤Á∂ìÊäïÊªø 5 Á•®Ôºå‰∏çËÉΩÂÜçÊäï‰∫Ü");
}else if(msg.includes("no_vote") || msg.includes("no_votes") || msg.includes("insufficient")){
  showError("‰Ω†Ê≤íÊúâÁ•®Âà∏ÔºåÁÑ°Ê≥ïÊäïÁ•®");
}else{
  showError("ÊäïÁ•®Â§±ÊïóÔºö" + msg);
}
console.error(e);
    }finally{
      if(btnEl) btnEl.disabled = Number(userVote || 0) <= 0;
    }
  }

  

function escapeHtml(str){
  if(str === null || str === undefined) return "";
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

function renderAvatarStackUrls(avatar){
  if(!avatar) return null;
  const headUrl = avatar.headUrl || (avatar.headId ? `/assets/${avatar.headId}.png` : "");
  const bodyUrl = avatar.bodyUrl || (avatar.bodyId ? `/assets/${avatar.bodyId}.png` : "");
  const bgUrl = avatar.bgUrl || (avatar.bgId ? `/assets/${avatar.bgId}.png` : "");
  const addon1Url = avatar.addon1Url || (avatar.addon1Id ? `/assets/${avatar.addon1Id}.png` : "");
  const addon2Url = avatar.addon2Url || (avatar.addon2Id ? `/assets/${avatar.addon2Id}.png` : "");
  const any = headUrl || bodyUrl || bgUrl || addon1Url || addon2Url;
  if(!any) return null;
  return { headUrl, bodyUrl, bgUrl, addon1Url, addon2Url };
}

function renderAvatarStackHTML(urls, altText){
  if(!urls) return `<span class="avTxt">${String(altText||"?").slice(0,1).toUpperCase()}</span>`;
  const safe = (u)=> escapeHtml(u||"");
  return `
    <span class="avStack" aria-label="avatar">
      ${urls.bgUrl ? `<img src="${safe(urls.bgUrl)}" alt="">` : ""}
      ${urls.bodyUrl ? `<img src="${safe(urls.bodyUrl)}" alt="">` : ""}
      ${urls.headUrl ? `<img src="${safe(urls.headUrl)}" alt="">` : ""}
      ${urls.addon1Url ? `<img src="${safe(urls.addon1Url)}" alt="">` : ""}
      ${urls.addon2Url ? `<img src="${safe(urls.addon2Url)}" alt="">` : ""}
    </span>
  `;
}

function renderAuthorAvatar(s, name){
  // Prefer composite avatar from saves
  const avatar = {
    headId: s.authorAvatarHeadId,
    bodyId: s.authorAvatarBodyId,
    bgId: s.authorAvatarBgId,
    addon1Id: s.authorAvatarAddon1Id,
    addon2Id: s.authorAvatarAddon2Id
  };
  const urls = renderAvatarStackUrls(avatar);
  if(urls) return renderAvatarStackHTML(urls, name);

  // Fallback to legacy recipe avatar
  const arid = String(s.authorAvatarRecipeId || "");
  if(arid) return `<img src="/assets/${escapeHtml(arid)}.png" alt="avatar" class="avImg">`;

  return `<span class="avTxt">${String(name||"?").slice(0,1).toUpperCase()}</span>`;
}
function fmtTime(ts){
    if (!ts) return "";
    try{
      const d = new Date(ts);
      if (!isFinite(d.getTime())) return String(ts);
      return d.toLocaleString();
    } catch { return String(ts); }
  }

  function makeStackThumb(container, layers){
    container.innerHTML = "";
    layers.forEach((l) => {
      if (!l.url) return;
      const div = document.createElement("div");
      div.className = "layer";
      div.style.zIndex = String(l.z || 0);
      const img = document.createElement("img");
      img.loading = "lazy";
      img.src = l.url;
      div.appendChild(img);
      container.appendChild(div);
    });
  }

  function openModalLayers(title, metaText, layers){
    modalTitle.textContent = title || "È†êË¶Ω";
    modalMeta.textContent = metaText || "";
    bigwrap.innerHTML = "";

    layers.forEach((l) => {
      if (!l.url) return;
      const div = document.createElement("div");
      div.className = "layer";
      div.style.zIndex = String(l.z || 0);
      const img = document.createElement("img");
      img.loading = "lazy";
      img.src = l.url;
      div.appendChild(img);
      bigwrap.appendChild(div);
    });

    modal.classList.add("show");
  }

  modalClose.onclick = () => modal.classList.remove("show");
  modal.onclick = (e) => { if (e.target === modal) modal.classList.remove("show"); };
  window.addEventListener("keydown", (e) => { if (e.key === "Escape") modal.classList.remove("show"); });

  function setSort(which){
    if(which === "top"){
      chipTop.classList.add("active");
      chipNewest.classList.remove("active");
    }else{
      chipNewest.classList.add("active");
      chipTop.classList.remove("active");
    }
    load();
  }

  chipNewest.onclick = () => setSort("new");
  chipTop.onclick = () => setSort("top");
  seasonSel.onchange = () => load();

const podiumWrap = document.getElementById("podiumWrap");
const podiumEl = document.getElementById("podium");
const podiumSub = document.getElementById("podiumSub");
let lastFilteredItems = [];

function top3ByVotes(items){
  return (items || [])
    .slice()
    .sort((a,b)=>{
      const av = Number(getVoteCount(a) || 0);
      const bv = Number(getVoteCount(b) || 0);
      if(bv !== av) return bv - av;
      return Number(b.createdAt || 0) - Number(a.createdAt || 0);
    })
    .slice(0,3);
}

function buildPodItem(rank, s){
  const item = document.createElement("div");
  item.className = "podItem rank" + String(rank);

  const top = document.createElement("div");
  top.className = "podTop";

  const r = document.createElement("div");
  r.className = "podRank";
  r.textContent = "#" + String(rank);

  const v = document.createElement("div");
  v.className = "podVotes";
  v.textContent = "Á•®Êï∏ " + String(getVoteCount(s));

  top.appendChild(r);
  top.appendChild(v);

  const th = document.createElement("div");
  th.className = "podThumb";
  const layersThumb = [
    { url: s.bgUrl, z: 10 },
    { url: s.addon2Url, z: 20 },
    { url: s.headUrl, z: 30 },
    { url: s.bodyUrl, z: 40 },
    { url: s.addon1Url, z: 50 },
  ];
  makeStackThumb(th, layersThumb);

  const meta = document.createElement("div");
  meta.className = "podMeta";

  const t = document.createElement("div");
  t.className = "t";
  const title = (s.title && String(s.title).trim()) ? String(s.title).trim() : "Êú™ÂëΩÂêç‰ΩúÂìÅ";
  t.textContent = title;

  const sline = document.createElement("div");
  sline.className = "s";
  sline.textContent = "@" + String(s.userId || "") + " ¬∑ " + fmtTime(s.createdAt) + (s.seasonId ? (" ¬∑ " + s.seasonId) : "");

  meta.appendChild(t);
  meta.appendChild(sline);

  item.appendChild(top);
  item.appendChild(th);
  item.appendChild(meta);

  item.onclick = () => {
    clearError();
    const layersBig = [
      { url: s.bgUrl, z: 10 },
      { url: s.addon2Url, z: 20 },
      { url: s.headUrl, z: 30 },
      { url: s.bodyUrl, z: 40 },
      { url: s.addon1Url, z: 50 },
    ];
    openModalLayers(title, "Á•®Êï∏ " + String(getVoteCount(s)) + " ¬∑ " + fmtTime(s.createdAt), layersBig);
  };

  return item;
}

function renderPodiumFromItems(items){
  lastFilteredItems = (items || []).slice();

  const top3 = top3ByVotes(lastFilteredItems);
  if(!top3 || top3.length === 0){
    if(podiumWrap) podiumWrap.style.display = "none";
    return;
  }

  if(podiumWrap) podiumWrap.style.display = "";
  if(podiumSub){
    const season = String(seasonSel.value || "").trim();
    podiumSub.textContent = season ? ("Season " + season + " ¬∑ Á•®Êï∏ÊúÄÈ´òÁöÑ 3 ÂÄã‰ΩúÂìÅ") : "Á•®Êï∏ÊúÄÈ´òÁöÑ 3 ÂÄã‰ΩúÂìÅ";
  }

  if(!podiumEl) return;
  podiumEl.innerHTML = "";

  // Order: 2,1,3 like a classic podium
  const m2 = top3[1] ? buildPodItem(2, top3[1]) : null;
  const m1 = top3[0] ? buildPodItem(1, top3[0]) : null;
  const m3 = top3[2] ? buildPodItem(3, top3[2]) : null;

  if(m2) podiumEl.appendChild(m2);
  if(m1) podiumEl.appendChild(m1);
  if(m3) podiumEl.appendChild(m3);
}

async function loadPodiumFromBackendOrLocal(items){
  const season = String(seasonSel.value || "").trim();
  // Try backend /api/podium first (if exists), otherwise fallback to local sort
  try{
    const qs = season ? ("?seasonId=" + encodeURIComponent(season)) : "";
    const r = await api("/api/podium" + qs);
    if(r && Array.isArray(r.items)){
      renderPodiumFromItems(r.items);
      return;
    }
  }catch(e){
    // ignore and fallback
  }
  renderPodiumFromItems(items);
}


  function render(items){
grid.innerHTML = "";
if(recGrid) recGrid.innerHTML = "";
if(recWrap) recWrap.style.display = "none";
if(!items || items.length === 0){
grid.innerHTML = '<div class="empty">ÁõÆÂâçÊ≤íÊúâ‰ªª‰ΩïÂ±ïÁ§∫‰ΩúÂìÅ</div>';
return;
}
// Êú¨ÊúüÊé®Ëñ¶: recommends > 1 ‰æùÊé®Ëñ¶Ê¨°Êï∏ÊéíÂ∫è
const recItems = (items || [])
.filter(x => Number(x.recommends || x.recommendCount || 0) > 1)
.slice()
.sort((a,b)=>{
const ar = Number(a.recommends || a.recommendCount || 0);
const br = Number(b.recommends || b.recommendCount || 0);
if(br !== ar) return br - ar;
const bv = Number(getVoteCount(b) || 0);
const av = Number(getVoteCount(a) || 0);
if(bv !== av) return bv - av;
return Number(b.createdAt || 0) - Number(a.createdAt || 0);
});
if(recItems.length > 0 && recWrap && recGrid){
recWrap.style.display = "block";
if(recSub) recSub.textContent = "Êé®Ëñ¶Ê¨°Êï∏ > 1 ¬∑ ‰æùÊé®Ëñ¶Ê¨°Êï∏ÊéíÂ∫è";
recItems.forEach((s)=>{
const card = document.createElement("div");
card.className = "recCard";
const th = document.createElement("div");
th.className = "recThumb";
const layersThumb = [
{ url: s.bgUrl, z: 10 },
{ url: s.addon2Url, z: 20 },
{ url: s.headUrl, z: 30 },
{ url: s.bodyUrl, z: 40 },
{ url: s.addon1Url, z: 50 },
];
makeStackThumb(th, layersThumb);
const meta = document.createElement("div");
meta.className = "recMeta";
const topRow = document.createElement("div");
topRow.className = "recTopRow";
const title = (s.title && String(s.title).trim()) ? String(s.title).trim() : "Êú™ÂëΩÂêç‰ΩúÂìÅ";
const tl = document.createElement("div");
tl.className = "recTitleLine";
tl.textContent = title;
const rc = Number(s.recommends || s.recommendCount || 0);
const badge = document.createElement("div");
badge.className = "recBadge";
badge.textContent = "Êé®Ëñ¶ " + String(rc);
topRow.appendChild(tl);
topRow.appendChild(badge);
meta.appendChild(topRow);
card.appendChild(th);
card.appendChild(meta);
card.onclick = ()=>{
clearError();
const layersBig = [
{ url: s.bgUrl, z: 10 },
{ url: s.addon2Url, z: 20 },
{ url: s.headUrl, z: 30 },
{ url: s.bodyUrl, z: 40 },
{ url: s.addon1Url, z: 50 },
];
openModalLayers(title, "Êé®Ëñ¶ " + String(rc) + " ¬∑ Á•®Êï∏ " + String(getVoteCount(s)) + " ¬∑ " + fmtTime(s.createdAt), layersBig);
};
recGrid.appendChild(card);
});
}
items.forEach((s) => {
const entry = document.createElement("div");
entry.className = "entry";
const th = document.createElement("div");
th.className = "entryThumb";
const layersThumb = [
{ url: s.bgUrl, z: 10 },
{ url: s.addon2Url, z: 20 },
{ url: s.headUrl, z: 30 },
{ url: s.bodyUrl, z: 40 },
{ url: s.addon1Url, z: 50 },
];
makeStackThumb(th, layersThumb);
const body = document.createElement("div");
body.className = "entryBody";
const header = document.createElement("div");
header.className = "entryHeader";
const title = (s.title && String(s.title).trim()) ? String(s.title).trim() : "Êú™ÂëΩÂêç‰ΩúÂìÅ";
const titleEl = document.createElement("div");
titleEl.className = "entryTitle";
titleEl.textContent = title;
const kv = document.createElement("div");
kv.className = "kv";
const votes = Number(getVoteCount(s) || 0);
const favs = Number(s.favorites || 0);
const recs = Number(s.recommends || s.recommendCount || 0);
const p1 = document.createElement("div");
p1.className = "pill2";
p1.textContent = "Á•®Êï∏ " + String(votes);
const p2 = document.createElement("div");
p2.className = "pill2";
p2.textContent = "Êî∂Ëóè " + String(favs);
header.appendChild(titleEl);
kv.appendChild(p1);
kv.appendChild(p2);
if(recs > 0){
const p3 = document.createElement("div");
p3.className = "pill2";
p3.textContent = "Êé®Ëñ¶ " + String(recs);
kv.appendChild(p3);
}
header.appendChild(kv);
const authorRow = document.createElement("div");
authorRow.className = "authorRow";
const authorMini = document.createElement("div");
authorMini.className = "authorMini";
const name = String(s.authorName || "").trim() || String(s.userName || "").trim() || String(s.userId || "").slice(0, 8);
const lv = Number(s.authorLevel || 1);
const av = document.createElement("div");
av.className = "av";
av.innerHTML = renderAuthorAvatar(s, name);
const nmWrap = document.createElement("div");
nmWrap.style.minWidth = "0";
const nm = document.createElement("div");
nm.className = "nm";
nm.textContent = name;
const lvEl = document.createElement("div");
lvEl.className = "lv";
lvEl.textContent = "Lv." + String(lv);
nmWrap.appendChild(nm);
nmWrap.appendChild(lvEl);
authorMini.appendChild(av);
authorMini.appendChild(nmWrap);
authorMini.onclick = (e)=>{ e.stopPropagation(); openUser(s.userId); };
const iconRow = document.createElement("div");
iconRow.className = "iconRow";
const sid = String(s.showcaseId || s.id || s.showcase_id || s.showcaseID || "");
const voteBtn = document.createElement("button");
voteBtn.className = "iconBtn";
voteBtn.type = "button";
voteBtn.title = "ÊäïÁ•®";
voteBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M7 10h10v10H7V10Z" stroke="currentColor" stroke-width="2"/><path d="M9 10V6h6v4" stroke="currentColor" stroke-width="2"/><path d="M10 14l2 2 3-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>' + "<span>ÊäïÁ•®</span>";
voteBtn.disabled = (!uid) || Number(userVote || 0) <= 0;
voteBtn.onclick = async (e)=>{
e.stopPropagation();
await voteFor(sid, voteBtn, null);
showToast("Â∑≤ÊäïÁ•®");
load();
};
const favBtn = document.createElement("button");
favBtn.className = "iconBtn";
favBtn.type = "button";
favBtn.title = "Êî∂Ëóè";
const isFav = favoriteSet.has(sid);
if(isFav) favBtn.classList.add("on");
favBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 21s-7-4.35-9.33-8.28C.7 9.25 2.3 6 6 6c2 0 3.1 1.1 4 2.2C10.9 7.1 12 6 14 6c3.7 0 5.3 3.25 3.33 6.72C19 16.65 12 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>' + "<span>" + (isFav ? "Â∑≤Êî∂Ëóè" : "Êî∂Ëóè") + "</span>";
favBtn.onclick = async (e)=>{
e.stopPropagation();
if(!uid) return showError("Ë´ãÂÖàÁôªÂÖ•");
try{
if(favoriteSet.has(sid)){
await api("/api/favorite", { method:"DELETE", body:{ showcaseId: sid } });
favoriteSet.delete(sid);
favBtn.classList.remove("on");
favBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 21s-7-4.35-9.33-8.28C.7 9.25 2.3 6 6 6c2 0 3.1 1.1 4 2.2C10.9 7.1 12 6 14 6c3.7 0 5.3 3.25 3.33 6.72C19 16.65 12 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>' + "<span>Êî∂Ëóè</span>";
showToast("Â∑≤ÂèñÊ∂àÊî∂Ëóè");
}else{
await api("/api/favorite", { method:"POST", body:{ showcaseId: sid } });
favoriteSet.add(sid);
favBtn.classList.add("on");
favBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 21s-7-4.35-9.33-8.28C.7 9.25 2.3 6 6 6c2 0 3.1 1.1 4 2.2C10.9 7.1 12 6 14 6c3.7 0 5.3 3.25 3.33 6.72C19 16.65 12 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>' + "<span>Â∑≤Êî∂Ëóè</span>";
showToast("Â∑≤Êî∂Ëóè");
}
}catch(err){
showError(String(err?.error || err?.message || err));
}
};
const recBtn = document.createElement("button");
recBtn.className = "iconBtn warn";
recBtn.type = "button";
recBtn.title = "Êé®Ëñ¶ 50 GEM";
recBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M13 3s1 3-1 5-1 4 2 5 4 6 0 8-8 0-8-5c0-4 3-5 3-8 0-2-1-3-1-3s4 1 5 3Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>' + "<span>Êé®Ëñ¶</span>";
recBtn.onclick = async (e)=>{
e.stopPropagation();
if(!uid) return showError("Ë´ãÂÖàÁôªÂÖ•");
try{
await api("/api/recommend", { method:"POST", body:{ showcaseId: sid } });
showToast("Â∑≤Êé®Ëñ¶ 1 Ê¨°");
await loadMyAccount();
load();
}catch(err){
showError(String(err?.error || err?.message || err));
}
};
iconRow.appendChild(voteBtn);
iconRow.appendChild(favBtn);
iconRow.appendChild(recBtn);
authorRow.appendChild(authorMini);
authorRow.appendChild(iconRow);
const metaLine = document.createElement("div");
metaLine.className = "metaLine";
metaLine.textContent = "@" + String(s.userId || "") + " ¬∑ " + fmtTime(s.createdAt) + (s.seasonId ? (" ¬∑ " + s.seasonId) : "");
body.appendChild(header);
body.appendChild(authorRow);
body.appendChild(metaLine);
entry.appendChild(th);
entry.appendChild(body);
entry.onclick = ()=>{
clearError();
const layersBig = [
{ url: s.bgUrl, z: 10 },
{ url: s.addon2Url, z: 20 },
{ url: s.headUrl, z: 30 },
{ url: s.bodyUrl, z: 40 },
{ url: s.addon1Url, z: 50 },
];
openModalLayers(title, "Á•®Êï∏ " + String(votes) + " ¬∑ Êî∂Ëóè " + String(favs) + (recs ? (" ¬∑ Êé®Ëñ¶ " + String(recs)) : "") + " ¬∑ " + fmtTime(s.createdAt), layersBig);
};
grid.appendChild(entry);
});
}
async function load
async function load(){
    await loadMeSocial();
    grid.innerHTML = "";
    clearError();
    statusLine.textContent = "ËÆÄÂèñ‰∏≠";

    try{
      const res = await api("/api/gallery");
      setNet(true);
      await loadMyAccount();

      const season = String(seasonSel.value || "").trim();
      let items = (res.items || []).slice();

      if(season){
        items = items.filter(x => String(x.seasonId || "") === season);
      }


       await loadPodiumFromBackendOrLocal(items);

      if(chipTop.classList.contains("active")){
        items.sort((a,b)=>{
          const av = Number(a.avgScore || 0);
          const bv = Number(b.avgScore || 0);
          if(bv !== av) return bv - av;
          const ac = Number(a.votes || 0);
          const bc = Number(b.votes || 0);
          if(bc !== ac) return bc - ac;
          return Number(b.createdAt || 0) - Number(a.createdAt || 0);
        });
      }else{
        items.sort((a,b)=> Number(b.createdAt || 0) - Number(a.createdAt || 0));
      }

      statusLine.textContent = "ÂÖ± " + items.length + " ÂÄã‰ΩúÂìÅ";
      render(items);

    }catch(e){
      setNet(false);
      statusLine.textContent = "ËÆÄÂèñÂ§±Êïó";
      showError("ËÆÄÂèñÂ§±ÊïóÔºåË´ãÁ¢∫Ë™çÂæåÁ´ØÂ∑≤Êúâ /api/galleryÔºå‰∏îË≥áÊñôÂ∫´Â≠òÂú® showcases / votes / assets");
      console.error(e);
    }
  }

  load();
})();
</script>
</body>
</html>
